.PHONY: all clean distclean install pkg-config

ifdef ENABLE_DEBUG
_CPPFLAGS=-UNDEBUG
_CFLAGS+=-g -O0 -Wall
else
_CPPFLAGS=-DNDEBUG
_CFLAGS+=-O2
endif

ABIVERSION=1
RELEASEVERSION=0
_SONAME=libhashit.so.$(ABIVERSION)

HASHIT_OBJECTS=$(patsubst %.c,%.o,$(wildcard src/*.c))
DEPENDENCIES=$(patsubst %.o,%.d,$(HASHIT_OBJECTS))
POFILES=$(wildcard po/*.po)

all: src/libhashit.so.$(ABIVERSION).$(RELEASEVERSION) pkg-config

src/libhashit.so.$(ABIVERSION).$(RELEASEVERSION): $(HASHIT_OBJECTS)
	$(MAKE.shared) $@ $^

pkg-config: libhashit.pc.in
	@$(call munge_file,libhashit.pc.in,libhashit.pc)

clean:
	@rm -rf $(HASHIT_OBJECTS) $(DEPENDENCIES) src/libhashit.so.*

distclean: clean
	@rm -rf Makefile config.mk config.h 

DIRMODE="a+rx,u+w"

install: all
	@$(call makedir,$(LIBDIR),$(DIRMODE))
	@$(call install_files,src/libhashit.so.1.0,$(LIBDIR),a=rx)
	@$(call makedir,$(INCDIR),$(DIRMODE))
	@$(call install_files,src/hashit.h,$(INCDIR),a=rx)
	@ln -s $(LIBDIR)/libhashit.so.$(ABIVERSION).$(RELEASEVERSION) $(LIBDIR)/libhashit.so 2> /dev/null; true
	@ldconfig
	
